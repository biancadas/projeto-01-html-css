"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7559,4261],{10243:function(e,t,n){n.d(t,{i:function(){return a}});var r=n(5284);async function a(){return await (0,r._i)("/user/active-event")}},5284:function(e,t,n){n.d(t,{T4:function(){return f},_i:function(){return _},aR:function(){return v}});var r=n(95567),a=n(38748),o=n(32510),s=n(85711);let i=(0,a.Z)(new Date,1);async function c(){return{accessToken:(0,o.jl)()[s.LJ.Token],refreshToken:(0,o.jl)()[s.LJ.RefreshToken]}}let l=async e=>{let{token:t,refreshToken:n}=e,r={path:"/",secure:!0,expires:i};(0,o.d8)(null,s.LJ.Token,t,r),(0,o.d8)(null,s.LJ.RefreshToken,n,r)};n(10276);let u="https://skylab-api.rocketseat.com.br",d=async e=>{let t=new Headers(e.headers);if(e.body instanceof FormData||t.set("Content-Type","application/json"),!t.get("Authorization")){let{accessToken:e}=await c();t.set("Authorization","Bearer ".concat(e))}return{...e,headers:t}};class f extends Error{constructor(e,t,n){super(e),this.message=e,this.config=t,this.response=n,this.name="FetcherError",this.status=null==n?void 0:n.status,this.isFetcherError=!0}}let h=async()=>{let{refreshToken:e}=await c(),t=await fetch("".concat(u,"/sessions/refresh"),{method:"POST",body:JSON.stringify({refresh_token:e}),headers:{"Content-Type":"application/json"}});if(!t.ok)throw new f(await t.json()||"An unexpected error occurred");let{token:n,refreshToken:r}=await t.json();await l({token:n,refreshToken:r})},_=async(e,t)=>{let n={};try{let{...r}=t||{},a=e.startsWith("http")?e:u+e,o=await d(r);if(n=await fetch(a,o),204===n.status)return Promise.resolve({});if(401===n.status){let r=await n.text();if(null==r?void 0:r.startsWith("E_JWT_TOKEN_EXPIRED"))return await h(),_(e,t)}if(!n.ok){let e=await n.json(),{message:t}=e.errors&&e.errors[0]||Array.isArray(e)&&e[0]||e.error||{};throw new f(t||"An unexpected error occurred")}return n.json()}catch(e){return Promise.reject(new f(e instanceof Error?e.message:e,t,n))}},v=async(e,t,n,a)=>{let{operationName:o}=(0,r.hc)(t);return(await _(e,{method:"POST",headers:{...a},body:JSON.stringify({query:t,variables:n,operationName:o})})).data}},85711:function(e,t,n){var r,a,o,s;n.d(t,{$B:function(){return c},LJ:function(){return r},Xp:function(){return i}}),(o=r||(r={})).Token="skylab_next_access_token_v3",o.RefreshToken="skylab_next_refresh_token_v3",(s=a||(a={}))[s.Second=1]="Second",s[s.Minute=60]="Minute",s[s.Hour=3600]="Hour",s[s.Day=86400]="Day";let i=new Date(2024,4,23),c=new Date(2024,4,24,23,59,59)},7346:function(e,t,n){n.d(t,{Ho:function(){return y},e6:function(){return k},aC:function(){return p}});var r=n(91674),a=n(86655),o=n(50333),s=n(6194),i=n(80893),c=n(32510),l=n(4993),u=n(44434);let d=new Date,f={path:"/",secure:!0,expires:new Date(d.setMonth(d.getMonth()+1))},h=(e,t)=>{var n,r;let{data:a}=e;if(t&&"function"==typeof t){let n=t(e);if(n)return o.toast.danger({title:n})}if(Array.isArray(a)&&a.length)return a.forEach(e=>{e.message&&o.toast.danger({title:e.message})});let s=null!==(r=null==a?void 0:null===(n=a.error)||void 0===n?void 0:n.message)&&void 0!==r?r:"Erro interno do servidor";return o.toast.danger({title:s})};var _=n(99164);let v=(0,a.createContext)({});function k(){(0,c.oU)(void 0,"skylab_next_access_token_v3",f),(0,c.oU)(void 0,"skylab_next_refresh_token_v3",f),(0,c.oU)(void 0,"skylab_login_as",f)}let y=e=>{let{children:t}=e,{isConnected:n,subscribeToChannel:d}=(0,_.r)(),[y,p]=(0,a.useState)(!0),[b,w]=(0,a.useState)(null),[g,m]=(0,a.useState)(null),x=(0,a.useRef)(!1),E=!!b,T=!!((null==b?void 0:b.createdAt)&&(0,s.Z)((0,i.Z)(new Date(b.createdAt)),new Date(2023,11,5,23,59,59))),A=(0,a.useCallback)(function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];k(),e&&(window.location.href="/?logout=true")},[]),j=(0,a.useCallback)(async()=>{let{skylab_next_access_token_v3:e,skylab_next_refresh_token_v3:t}=(0,c.jl)();if(!e||!t){p(!1);return}l.h.defaults.headers.Authorization="Bearer ".concat(e),m(e);try{let e=await l.h.get("/account");w(e.data),p(!1)}catch(e){A()}},[A]),S=(0,a.useCallback)(async(e,t)=>{try{let{data:{token:n,refreshToken:r}}=await l.h.post("sessions",{email:e,password:t});(0,c.d8)(void 0,"skylab_next_access_token_v3",n,f),(0,c.d8)(void 0,"skylab_next_refresh_token_v3",r,f)}catch(e){throw h((null==e?void 0:e.response)||""),Error()}},[]),C=(0,a.useCallback)(async(e,t)=>{try{let{data:{token:n,refreshToken:r}}=await l.h.post("/v2/registration/verify",{code:t,email:e});(0,c.d8)(void 0,"skylab_next_access_token_v3",n,f),(0,c.d8)(void 0,"skylab_next_refresh_token_v3",r,f),p(!0),j()}catch(e){throw h((null==e?void 0:e.response)||""),Error()}},[j]),D=(0,a.useCallback)(async e=>{try{let{data:{token:t,refreshToken:n}}=await l.h.get("/v2/github/callback?code=".concat(e));(0,c.d8)(void 0,"skylab_next_access_token_v3",t,f),(0,c.d8)(void 0,"skylab_next_refresh_token_v3",n,f)}catch(e){throw h((null==e?void 0:e.response)||""),Error()}},[]);(0,a.useEffect)(()=>{j()},[j]),(0,a.useEffect)(()=>{b&&E&&!x.current&&((0,u.R)({userId:b.id,name:b.name,email:b.email}),x.current=!0)},[E,b]),(0,a.useEffect)(()=>{b&&n&&d("user:".concat(b.id)).then(e=>{e.on("logout",e=>{let{forced:t=!1}=e;t||o.toast.danger({title:"Sua conta foi acessada em outro navegador."}),A()})})},[b,n,d,A]);let R=(0,a.useMemo)(()=>({isAuthenticated:E,isRecoveringUserSession:y,isNewUser:T,user:b,setUser:w,signIn:S,signInVerify:C,signInGithub:D,signOut:A,jwtToken:g,recoverUserSession:j}),[E,y,T,b,S,C,D,A,g,j]);return(0,r.jsx)(v.Provider,{value:R,children:t})};function p(){return(0,a.useContext)(v)}},99164:function(e,t,n){let r;n.d(t,{r:function(){return s}});var a=n(86655),o=n(32510);function s(){let[e,t]=(0,a.useState)(!1),s=(0,a.useCallback)(async()=>{r=(await n.e(1808).then(n.t.bind(n,71808,23)))("".concat("wss","://").concat("skylab-api.rocketseat.com.br"),{reconnectionAttempts:15});let{skylab_next_access_token_v3:e}=(0,o.jl)();e&&r.withApiToken(e),r.connect(),r.on("open",()=>{t(!0)}),r.on("close",e=>{"terminated"!==e._connectionState&&t(!1)})},[]),i=(0,a.useCallback)(async e=>{r||await s();let t=r.getSubscription(e);return t||(t=r.subscribe(e)),t},[s]);return{isConnected:e,connectToWebsocket:s,subscribeToChannel:i}}},4993:function(e,t,n){n.d(t,{h:function(){return r}});let r=(0,n(29073).R)()},29073:function(e,t,n){n.d(t,{R:function(){return d}});var r=n(89099),a=n.n(r),o=n(32510),s=n(7346);let i=!1,c=[],l=new Date,u=new Date(l.setMonth(l.getMonth()+1));function d(e){let t=(0,o.jl)(e),n=a().create({baseURL:"https://skylab-api.rocketseat.com.br",headers:{Authorization:"Bearer ".concat(t.skylab_next_access_token_v3)}});return n.interceptors.response.use(e=>e,r=>{var a,l,d,f;if((null===(a=r.response)||void 0===a?void 0:a.status)===401){if("error"in(null===(l=r.response)||void 0===l?void 0:l.data));else if(null===(f=r.response)||void 0===f?void 0:null===(d=f.data)||void 0===d?void 0:d.startsWith("E_JWT_TOKEN_EXPIRED")){let{skylab_next_refresh_token_v3:a}=t=(0,o.jl)(e),l=r.config;return i||(i=!0,n.post("/sessions/refresh",{refreshToken:a}).then(t=>{let{token:r}=t.data,a={path:"/",secure:!0,expires:u};(0,o.d8)(e,"skylab_next_access_token_v3",r,a),(0,o.d8)(e,"skylab_next_refresh_token_v3",t.data.refreshToken,a),n.defaults.headers.Authorization="Bearer ".concat(r),c.forEach(e=>e.onSuccess(r)),c=[]}).catch(e=>{c.forEach(t=>t.onFailure(e)),c=[],(0,s.e6)()}).finally(()=>{i=!1})),new Promise((e,t)=>{c.push({onSuccess:t=>{l.headers.Authorization="Bearer ".concat(t),e(n(l))},onFailure:e=>{t(e)}})})}else(0,s.e6)()}return Promise.reject(r)}),n}},44434:function(e,t,n){let r;n.d(t,{I:function(){return o.a},R:function(){return s}});var a=n(21934),o=n.n(a);async function s(e){let{userId:t,name:a,email:o}=e;r?(r.identify(t),r.people.set({$name:a,$email:o,client:"next"})):(r=await Promise.resolve().then(n.t.bind(n,21934,23))).init("dcd1a0bcd016c8755ab3fd5ecb19a45e",{track_pageview:!0,loaded:e=>{e.identify(t),e.people.set({$name:a,$email:o,client:"next"})}})}o().init("dcd1a0bcd016c8755ab3fd5ecb19a45e",{track_pageview:!0})}}]);