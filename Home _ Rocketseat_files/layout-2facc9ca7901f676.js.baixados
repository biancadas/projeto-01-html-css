(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3105],{4834:function(e,t,n){Promise.resolve().then(n.bind(n,18890))},18890:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return u}});var r=n(91674),a=n(86655),o=n(54603),s=n(7346);function c(){let{user:e,isRecoveringUserSession:t}=(0,s.aC)(),n=(0,o.useRouter)(),r=(0,o.usePathname)(),c=(0,o.useSearchParams)();return(0,a.useEffect)(()=>{if(!t&&!e){let e="".concat(r,"?").concat(c);n.push("/?to=".concat(encodeURIComponent(e)))}},[t,n,e,r,c]),null}function u(e){let{children:t}=e;return(0,r.jsxs)(r.Fragment,{children:[t,(0,r.jsx)(a.Suspense,{children:(0,r.jsx)(c,{})})]})}},7346:function(e,t,n){"use strict";n.d(t,{Ho:function(){return b},e6:function(){return k},aC:function(){return p}});var r=n(91674),a=n(86655),o=n(50333),s=n(6194),c=n(80893),u=n(32510),i=n(4993),l=n(44434);let d=new Date,f={path:"/",secure:!0,expires:new Date(d.setMonth(d.getMonth()+1))},h=(e,t)=>{var n,r;let{data:a}=e;if(t&&"function"==typeof t){let n=t(e);if(n)return o.toast.danger({title:n})}if(Array.isArray(a)&&a.length)return a.forEach(e=>{e.message&&o.toast.danger({title:e.message})});let s=null!==(r=null==a?void 0:null===(n=a.error)||void 0===n?void 0:n.message)&&void 0!==r?r:"Erro interno do servidor";return o.toast.danger({title:s})};var _=n(99164);let v=(0,a.createContext)({});function k(){(0,u.oU)(void 0,"skylab_next_access_token_v3",f),(0,u.oU)(void 0,"skylab_next_refresh_token_v3",f),(0,u.oU)(void 0,"skylab_login_as",f)}let b=e=>{let{children:t}=e,{isConnected:n,subscribeToChannel:d}=(0,_.r)(),[b,p]=(0,a.useState)(!0),[m,y]=(0,a.useState)(null),[w,g]=(0,a.useState)(null),x=(0,a.useRef)(!1),E=!!m,P=!!((null==m?void 0:m.createdAt)&&(0,s.Z)((0,c.Z)(new Date(m.createdAt)),new Date(2023,11,5,23,59,59))),S=(0,a.useCallback)(function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];k(),e&&(window.location.href="/?logout=true")},[]),C=(0,a.useCallback)(async()=>{let{skylab_next_access_token_v3:e,skylab_next_refresh_token_v3:t}=(0,u.jl)();if(!e||!t){p(!1);return}i.h.defaults.headers.Authorization="Bearer ".concat(e),g(e);try{let e=await i.h.get("/account");y(e.data),p(!1)}catch(e){S()}},[S]),R=(0,a.useCallback)(async(e,t)=>{try{let{data:{token:n,refreshToken:r}}=await i.h.post("sessions",{email:e,password:t});(0,u.d8)(void 0,"skylab_next_access_token_v3",n,f),(0,u.d8)(void 0,"skylab_next_refresh_token_v3",r,f)}catch(e){throw h((null==e?void 0:e.response)||""),Error()}},[]),A=(0,a.useCallback)(async(e,t)=>{try{let{data:{token:n,refreshToken:r}}=await i.h.post("/v2/registration/verify",{code:t,email:e});(0,u.d8)(void 0,"skylab_next_access_token_v3",n,f),(0,u.d8)(void 0,"skylab_next_refresh_token_v3",r,f),p(!0),C()}catch(e){throw h((null==e?void 0:e.response)||""),Error()}},[C]),j=(0,a.useCallback)(async e=>{try{let{data:{token:t,refreshToken:n}}=await i.h.get("/v2/github/callback?code=".concat(e));(0,u.d8)(void 0,"skylab_next_access_token_v3",t,f),(0,u.d8)(void 0,"skylab_next_refresh_token_v3",n,f)}catch(e){throw h((null==e?void 0:e.response)||""),Error()}},[]);(0,a.useEffect)(()=>{C()},[C]),(0,a.useEffect)(()=>{m&&E&&!x.current&&((0,l.R)({userId:m.id,name:m.name,email:m.email}),x.current=!0)},[E,m]),(0,a.useEffect)(()=>{m&&n&&d("user:".concat(m.id)).then(e=>{e.on("logout",e=>{let{forced:t=!1}=e;t||o.toast.danger({title:"Sua conta foi acessada em outro navegador."}),S()})})},[m,n,d,S]);let M=(0,a.useMemo)(()=>({isAuthenticated:E,isRecoveringUserSession:b,isNewUser:P,user:m,setUser:y,signIn:R,signInVerify:A,signInGithub:j,signOut:S,jwtToken:w,recoverUserSession:C}),[E,b,P,m,R,A,j,S,w,C]);return(0,r.jsx)(v.Provider,{value:M,children:t})};function p(){return(0,a.useContext)(v)}},99164:function(e,t,n){"use strict";let r;n.d(t,{r:function(){return s}});var a=n(86655),o=n(32510);function s(){let[e,t]=(0,a.useState)(!1),s=(0,a.useCallback)(async()=>{r=(await n.e(1808).then(n.t.bind(n,71808,23)))("".concat("wss","://").concat("skylab-api.rocketseat.com.br"),{reconnectionAttempts:15});let{skylab_next_access_token_v3:e}=(0,o.jl)();e&&r.withApiToken(e),r.connect(),r.on("open",()=>{t(!0)}),r.on("close",e=>{"terminated"!==e._connectionState&&t(!1)})},[]),c=(0,a.useCallback)(async e=>{r||await s();let t=r.getSubscription(e);return t||(t=r.subscribe(e)),t},[s]);return{isConnected:e,connectToWebsocket:s,subscribeToChannel:c}}},4993:function(e,t,n){"use strict";n.d(t,{h:function(){return r}});let r=(0,n(29073).R)()},29073:function(e,t,n){"use strict";n.d(t,{R:function(){return d}});var r=n(89099),a=n.n(r),o=n(32510),s=n(7346);let c=!1,u=[],i=new Date,l=new Date(i.setMonth(i.getMonth()+1));function d(e){let t=(0,o.jl)(e),n=a().create({baseURL:"https://skylab-api.rocketseat.com.br",headers:{Authorization:"Bearer ".concat(t.skylab_next_access_token_v3)}});return n.interceptors.response.use(e=>e,r=>{var a,i,d,f;if((null===(a=r.response)||void 0===a?void 0:a.status)===401){if("error"in(null===(i=r.response)||void 0===i?void 0:i.data));else if(null===(f=r.response)||void 0===f?void 0:null===(d=f.data)||void 0===d?void 0:d.startsWith("E_JWT_TOKEN_EXPIRED")){let{skylab_next_refresh_token_v3:a}=t=(0,o.jl)(e),i=r.config;return c||(c=!0,n.post("/sessions/refresh",{refreshToken:a}).then(t=>{let{token:r}=t.data,a={path:"/",secure:!0,expires:l};(0,o.d8)(e,"skylab_next_access_token_v3",r,a),(0,o.d8)(e,"skylab_next_refresh_token_v3",t.data.refreshToken,a),n.defaults.headers.Authorization="Bearer ".concat(r),u.forEach(e=>e.onSuccess(r)),u=[]}).catch(e=>{u.forEach(t=>t.onFailure(e)),u=[],(0,s.e6)()}).finally(()=>{c=!1})),new Promise((e,t)=>{u.push({onSuccess:t=>{i.headers.Authorization="Bearer ".concat(t),e(n(i))},onFailure:e=>{t(e)}})})}else(0,s.e6)()}return Promise.reject(r)}),n}},44434:function(e,t,n){"use strict";let r;n.d(t,{I:function(){return o.a},R:function(){return s}});var a=n(21934),o=n.n(a);async function s(e){let{userId:t,name:a,email:o}=e;r?(r.identify(t),r.people.set({$name:a,$email:o,client:"next"})):(r=await Promise.resolve().then(n.t.bind(n,21934,23))).init("dcd1a0bcd016c8755ab3fd5ecb19a45e",{track_pageview:!0,loaded:e=>{e.identify(t),e.people.set({$name:a,$email:o,client:"next"})}})}o().init("dcd1a0bcd016c8755ab3fd5ecb19a45e",{track_pageview:!0})},54603:function(e,t,n){"use strict";var r=n(2988);n.o(r,"notFound")&&n.d(t,{notFound:function(){return r.notFound}}),n.o(r,"useParams")&&n.d(t,{useParams:function(){return r.useParams}}),n.o(r,"usePathname")&&n.d(t,{usePathname:function(){return r.usePathname}}),n.o(r,"useRouter")&&n.d(t,{useRouter:function(){return r.useRouter}}),n.o(r,"useSearchParams")&&n.d(t,{useSearchParams:function(){return r.useSearchParams}}),n.o(r,"useServerInsertedHTML")&&n.d(t,{useServerInsertedHTML:function(){return r.useServerInsertedHTML}})}},function(e){e.O(0,[1203,7120,1112,5955,2586,7229,35,333,1293,9997,1744],function(){return e(e.s=4834)}),_N_E=e.O()}]);